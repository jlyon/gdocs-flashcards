!function($){"use strict";
//***************************************
// Main Application
// To get direct links to audio files in Google Drive: http://directlink.booogle.net/
//***************************************
angular.module("app",["ui.router","ngAnimate"]).run(["$sce","$timeout","$rootScope","$state","$stateParams",function($sce,$timeout,$rootScope,$state,$stateParams){
// It's very handy to add references to $state and $stateParams to the $rootScope
$rootScope.$state=$state,$rootScope.$stateParams=$stateParams}]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function($locationProvider,$stateProvider,$urlRouterProvider){
/////////////////////////////
// Redirects and Otherwise //
/////////////////////////////
// Use $urlRouterProvider to configure any redirects (when) and invalid urls (otherwise).
$urlRouterProvider.when("","/"),
//.otherwise(token ? '/sites' : '/start');
//////////////////////////
// State Configurations //
//////////////////////////
$stateProvider.state("flashcards",{url:"/flashcards?doc&sheet",templateUrl:"views/flashcards.html",
// auth: true,
/*resolve: {
                            cards: function ($stateParams, $rootScope, $http) {

                            }
                        },*/
controller:function($scope,$rootScope,$state,$filter,$http){function shuffle(array){
// While there remain elements to shuffle...
for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)
// Pick a remaining element...
randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,
// And swap it with the current element.
temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}
//var url  = 'https://docs.google.com/spreadsheets/d/1pyCptrdv3-laxJPSbXda_bfC5HiyOlpeuP_LVgBVuxA/pubhtml';
//url = $state.params.doc;
//var matched = url.match(/https:\/\/docs.google.com\/spreadsheets\/d\/(.+)\/pubhtml/);
//var id = matched[1];
var sheet=$state.params.sheet?$state.params.sheet:1,doc=$state.params.doc,feed="https://spreadsheets.google.com/feeds/list/"+doc+"/"+sheet+"/public/values?alt=json",oAudio=document.getElementById("myaudio"),colors={red:"#EA3424",orange:"#F19E39",yellow:"#FEFF54","light green":"#AFE8CC","dark green":"#78A65A",blue:"#cfe6f9",purple:"#b687d3"};$http({method:"GET",url:feed}).then(function(response){for(var data=response.data.feed.entry,out=[],i=0;i<data.length;i++)out.push({question:data[i].gsx$question.$t,color:colors[data[i].gsx$color.$t]?colors[data[i].gsx$color.$t]:"white",recording:data[i].gsx$recording?data[i].gsx$recording.$t:null,answer:data[i].gsx$answer?data[i].gsx$answer.$t:null,pronunciation:data[i].gsx$pronunciation?data[i].gsx$pronunciation.$t:null});out=shuffle(out),resetList(out)},function(response){});var resetList=function(data){$scope.data=data,$scope.total=data.length,$scope.i=0,go(0)},go=$scope.go=function(delta){$scope.i+=delta,$scope.i<0&&($scope.i=0),$scope.i>=$scope.total?$scope.stage="done":($scope.item=$scope.data[$scope.i],$scope.stage="question",oAudio.pause(),oAudio.src=$scope.item.recording)};$scope.play=function(){$scope.stage="answer",oAudio.volume=1,// Try to set the vol as high as possible
oAudio.play()};$scope.answers={correct:0,incorrect:0};$scope.answer=function(status){$scope.item.status=status,$scope.answers[status]++,go(1)};$scope.filteredList=function(status){if($scope.answers[status]>0){var data=$scope.data.filter(function(record){return"incorrect"==record.status});resetList(data)}}}}).state("done",{url:"/congratulations?doc&sheet&color",templateUrl:"views/done.html",
// auth: true,
/*resolve: {
                         cards: function ($stateParams, $rootScope, $http) {

                         }
                         },*/
controller:function($scope,$rootScope,$state,$filter,$http){$scope.color=$state.params.color}})}])}(jQuery);